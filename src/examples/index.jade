extends _layout.jade
block body
  body(ng-app='x-gif-demo' ng-controller='DemoCtrl')
    .row
      .column.medium-9.medium-centered.large-8
        header
          h1= "<x-gif>"
          h4 The GIF tag the internet deserves
          h6
            a(href='https://github.com/geelen/x-gif' target='_blank') View source on GitHub
        hr
        dl.sub-nav
          dt Examples:
          dd(ng-repeat='url in gifs' ng-class='{active: gif.url == url}')
            a(ng-href='#{{ url }}')  {{ $index + 1 }}
        label
          | Or choose your own. Be sure to choose a server with permissive CORS headers, e.g. imgur
          input(type='text' ng-model='gif.url')
        h3 Normal playback
        p.small
          | Something not look right?
          a(href='https://github.com/geelen/x-gif/issues' target='_blank')
            | Post an
            | issue on GitHub
          | with the URL of the image
        figure
          x-gif(ng-src='{{ trustedUrl() }}')
          figcaption
            pre.
              \n<x-gif src="{{ trustedUrl() }}"></x-gif>
        h3 Ping-pong
        figure
          x-gif(ng-src='{{ trustedUrl() }}' ping-pong='ping-pong')
          figcaption
            pre.
              \n<x-gif src="{{ trustedUrl() }}" ping-pong></x-gif>
        h3 N-times
        button.button.tiny.radius(ng-click='nTimesRestart()' type='button' style='padding: 0.8em;') Restart
        input(type='range' min='0.1' max='3.0' step='0.1' ng-model='gif.nTimes')
        | {{ gif.nTimes }}
        figure
          x-gif#nTimes(ng-src='{{ trustedUrl() }}' n-times='{{ gif.nTimes }}')
          figcaption
            pre.
              \n<x-gif src="{{ trustedUrl() }}" n-times="{{ gif.nTimes }}"{{ nTimesIsStopped() }}></x-gif>
        h3 Speed
        figure
          label
            input(type='range' min='0.1' max='5' step='0.1' ng-model='gif.speed')
            | {{ gif.speed }}
          x-gif(ng-src='{{ trustedUrl() }}' speed='{{ gif.speed }}')
          figcaption
            pre.
              \n<x-gif src="{{ trustedUrl() }}" speed="{{ gif.speed }}"></x-gif>
        h3 BPM
        figure
          label
            input(type='range' min='30' max='240' step='1' ng-model='gif.bpm')
            | {{ gif.bpm }}
          x-gif(ng-src='{{ trustedUrl() }}' bpm='{{ gif.bpm }}')
          figcaption
            pre.
              \n<x-gif src="{{ trustedUrl() }}" bpm="{{ gif.bpm }}"></x-gif>
          x-gif(ng-src='{{ trustedUrl() }}' bpm='{{ gif.bpm }}' snap='snap')
          figcaption
            pre= '<x-gif src="{{ trustedUrl() }}" bpm="{{ gif.bpm }}" snap></x-gif>'
        h3 Synced to Audio
        figure
          div(ng-show='gif.metadata')
            audio(controls='controls' preload='preload')
              source(src='assets/encom_part_ii.ogg' type='audio/ogg')
              source(src='assets/encom_part_ii.mp3' type='audio/mpeg')
            p
              | Playback speed: {{ gif.playbackRate | number:1 }}
              a(href='href' ng-click='changeSpeed(0.1)') +
              a(href='href' ng-click='changeSpeed(-0.1)') -
          div(ng-hide='gif.metadata') Loading beat data...
          x-gif.x-gif-synced-demo(ng-src='{{ trustedUrl() }}' sync='sync')
          figcaption
            pre.
              \n<x-gif src="{{ trustedUrl() }}" synced></x-gif>
          x-gif.x-gif-synced-demo(ng-src='{{ trustedUrl() }}' sync='sync' snap='snap')
          figcaption
            pre.
              \n<x-gif src="{{ trustedUrl() }}" synced snap></x-gif>
            p
              | Audio: Encom Part II by Daft Punk. CC0 1.0 Universal.
              br
              | Source:
              a(href='https://archive.org/details/DaftPunkTronLegacyEncomPartIi' target='_blank') Archive.org
              br
              | Beat metadata provided by
              a(href='http://echonest.com/') Echo Nest
            h5
              a(href='demos/audio.html') See a full screen demo
        h3 Stop-start
        pre.
          \n<x-gif src="{{ trustedUrl() }}" stopped></x-gif>
        h5
          a(href='demos/stoppable.html') See demo
        h3 Exploded
        pre.
          \n<x-gif src="{{ trustedUrl() }}" exploded></x-gif>
        p Explode the gif into its component frames (handy for debugging)
        h5
          a(href='demos/exploded.html') See demo
        hr
        footer
          h5
            | Made with
            3(by='by')
          img.me(src='http://i.imgur.com/x577Tga.jpg' alt='')
          br
          a(target='_blank' href='https://twitter.com/glenmaddern') @glenmaddern
    script(src="assets/synched_playback.js")
    script(type='text/javascript' charset='utf-8').
      angular.module('x-gif-demo', []).controller('DemoCtrl', function ($scope, $sce, $location, $http) {
        $scope.gifs = [
          "http://i.imgur.com/iKXH4E2.gif",
          "http://i.imgur.com/RY2vTBQ.gif",
          "http://i.imgur.com/YlxOOI7.gif",
          "http://i.imgur.com/5KSc0px.gif",
          "http://i.imgur.com/m25uYzq.gif",
          "http://i.imgur.com/ifR7csn.gif"
        ];
        $scope.gif = {
          url: $scope.gifs[0],
          speed: 2,
          bpm: 60,
          playbackRate: 1,
          nTimes: 1.0
        };
        var audio = document.querySelector('audio');
        $scope.changeSpeed = function (delta) {
          audio.playbackRate = Math.max(0.5, audio.playbackRate + delta);
          $scope.gif.playbackRate = audio.playbackRate;
        }
        var nTimesElem = document.querySelector('#nTimes');
        $scope.nTimesRestart = function () {
          nTimesElem.removeAttribute('stopped');
        }
        $scope.nTimesIsStopped = function () {
          return nTimesElem.hasAttribute('stopped') ? " stopped" : "";
        }
        nTimesElem.addEventListener('x-gif-finished', function () {
          $scope.$apply();
        })
        $http.get('assets/encom_part_ii.json').then(function (response) {
          $scope.gif.metadata = response.data;
          setupAudioSynching(audio,
            document.querySelectorAll('.x-gif-synced-demo'),
            $scope.gif.metadata)
        })
        $scope.trustedUrl = function () {
          return $sce.trustAsResourceUrl($scope.gif.url);
        }
        $scope.loc = $location;
        $scope.$watch('loc.path()', function (e) {
          if (e) $scope.gif.url = e.slice(1);
        })
        $scope.$watch('gif.url', function (e) {
          if (e) $scope.loc.path(e);
        })
      });
    script.
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
          m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
      ga('create', 'UA-32408977-5', 'geelen.github.io');
      ga('send', 'pageview');
